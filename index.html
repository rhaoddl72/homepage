<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>

<script type="text/javascript" src="<%=request.getContextPath()%>/resources/js/jquery.validate.min.js"></script>
<script type="text/javascript" src="<%=request.getContextPath()%>/resources/js/additional-methods.min.js"></script>

<style type="text/css">
	
	.error{
	color: red;
	}
	
</style>
</head>
<body>
   <form class = "container" method = "post" action = "<%=request.getContextPath()%>/user/signup" id="signup">
	<h1>회원가입</h1>
	<div class="form-group">
	  <label>id:</label>
	  <input type="text" class="form-control" name="us_id">
	</div>
	  <button type="button" class="id-dup-btn input-group-oppend btn btn-outline-success">아이디 중복 확인</button>
	<div class="form-group">
	  <label>Password:</label>
	  <input type="password" class="form-control" name="us_pw" id="us_pw">
	</div>
	<div class="form-group">
	  <label>Password confirm:</label>
	  <input type="password" class="form-control" name="us_pw2">
	</div>
	<div class="form-group">
	  <label>이름:</label>
	  <input type="text" class="form-control" name="us_name">
	</div>
	<div class="form-group">
	  <label>생년월일:</label>
	  <div class="input-group">
	  <input type="text" class="form-control col-4" name="year" placeholder="년(4자)" maxlength="4">
	  <select class="form-control col-4" name="month">
	  	<option value="">월</option>
	  	<option value="1">1</option>
	  	<option value="2">2</option>
	  	<option value="3">3</option>
	  	<option value="4">4</option>
	  	<option value="5">5</option>
	  	<option value="6">6</option>
	  	<option value="7">7</option>
	  	<option value="8">8</option>
	  	<option value="9">9</option>
	  	<option value="10">10</option>
	  	<option value="11">11</option>
	  	<option value="12">12</option> 
	  </select>
	  <input type="text" class="form-control col-4" name="day" placeholder="일" maxlength="2">
	  <input type="hidden" name="us_birth">
	  </div>
	</div>
	<div class="form-group">
	  <label>성별:</label>
	  <select class="form-control col-2" name="us_gender">
	  <option value="M">남성</option>
	  <option value="F">여성</option>
	  </select>
	</div>
	<div class="form-group">
		<label>전화번호:</label>
		<div class="input-group"> 
		<input type="text" class="form-control col-3 ml-1" name="gookbun" placeholder="010"> - 
		<input type="text" class="form-control col-3" name="first_phone"> -  
		<input type="text" class="form-control col-3" name="last_phone">
		<input type="hidden" name="us_phone">
		</div>
		<button class="btn btn-outline-success mt-1" >인증번호받기</button>
	</div>
	<div class="form-group">
		<label>주소:</label> 
		<input type="text" class="form-control col-5" name="first_address"> 
		<input type="text" class="form-control col-5" name="last_address">
		<input type="hidden" name="us_address">
	</div>  
	<div class="form-group">
	  <label>이메일:</label>
	  <input type="text" class="form-control" name="us_email">
	</div>
	
	<div class="form-group">
	  <label>자기소개:</label>
	  <input type="text" class="form-control" name="us_myself">
	</div>
	
	<button class="btn btn-outline-success col-12">회원가입</button>
</form>

<script type="text/javascript">
	$(function(){
	    $("form").validate({
	        rules: {
	            us_id: {
	                required : true,
	                regex : /^[a-z0-9_-]{5,20}$/
	            },
	            us_pw: {
	                required : true,
	                regex: /^[a-z0-9!@#]{8,16}$/i
	            },
	            us_pw2: {
	                required : true,
	                equalTo : us_pw
	            },
	            us_name: {
	                required : true,
	                regex: /^[^ㄱ-ㅎㅏ-ㅣ!@#\s]+$/
	           
	            },
	            us_birth: {
	                required : true
	           
	            },
	            us_phone: {
	                required : true
	           
	            },
	            us_address: {
	                required : true
	           
	            },
	            us_email: {
	                required : true,
	                email : true
	            }
	        },
	        //규칙체크 실패시 출력될 메시지
	        messages : {
	            us_id: {
	                required : "필수 정보입니다.",
	                regex : "5~20자의 영문 소문자, 숫자와 특수기호(_),(-)만 사용 가능합니다."
	            },
	            us_pw: {
	                required : "필수 정보입니다.",   
	                regex : "8~16자 영문 대 소문자, 숫자, 특수문자를 사용하세요."
	            },
	            us_pw2: {
	                required : "필수 정보입니다.",
	                equalTo : "비밀번호와 일치하지 않습니다."
	            },
	            us_name: {
	                required : "필수 정보입니다."
	            },
	            us_birth: {
	                required : "필수 정보입니다."
	           
	            },
	            us_phone: {
	                required : "필수 정보입니다."
	           
	            },
	            us_address: {
	                required : "필수 정보입니다."
	           
	            },
	            us_email: {
	                required : "필수 정보입니다.",
	                email : "메일규칙에 어긋납니다"
	            }
	        }, submitHandler: function(form){
	       	 
		    	 
			     
			     var year = $('[name=year]').val();
			     var month = $('[name=month]').val();
			     var day = $('[name=day]').val();
			     var birth = year+"년"+month+"월"+day+"일";
			     $('[name=us_birth]').val(birth);
			     
			     var gookbun = $('[name=gookbun]').val();
			     var first_phone = $('[name=first_phone]').val();
			     var last_phone = $('[name=last_phone]').val();
			     var phone = gookbun+"-"+first_phone+"-"+last_phone;
			     $('[name=us_phone]').val(phone);
			     
			     var first_address = $('[name=first_address]').val();
			     var last_address = $('[name=last_address]').val();
			     var address = first_address+last_address;
			     $('[name=us_address]').val(address);

			     
			 
			     $('form').submit();
		    }
	    });
	    
	    $('.id-dup-btn').click(function() {
			var id = $('[name=us_id]').val();
			var res = userService.idCheck(contextPath, id);
			if(res)
				alert('사용 가능한 아이디입니다.')
			else
				alert('이미 가입된 아이디입니다.')
		})
	})
	$.validator.addMethod(
	    "regex",
	    function(value, element, regexp) {
	        var re = new RegExp(regexp);
	        return this.optional(element) || re.test(value);
	    },
	    "Please check your input."
	);
	
	
	//모듈화 reply.js처럼
	var contextPath = '<%=request.getContextPath()%>';
	var userService = (function() {
		
		function idCheck(contextPath, us_id) {
			var flag = false;
			$.ajax({
				async : false,
				type : 'post',
				url : contextPath + '/id/check',
				data : {us_id : us_id},
				success : function(res){
					if(res == 'OK'){
						flag = true
					}else{
						flag = false
					}
					
				}
			})
			return flag;
		}
		return {
			name : 'userService',
			idCheck : idCheck
		}
	})();


</script>
   
</body>
</html>
